<!DOCTYPE HTML>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>window.performance.timing for dynamically created documents</title>
<script src="/resources/testharness.js"></script>
<script src="/webperf/tests/resources/webperftestharness.js"></script>
<link rel="stylesheet" href="/resources/testharness.css" />

<script>
var timing = performanceNamespace.timing;
var originalTiming = {};

function onload_test() {
  setTimeout(testTimingWithDocumentOpen, 0);
}

function testTimingWithDocumentOpen() {
  for (property in timing) {
    originalTiming[property] = timing[property];
  }

  var subdocument = document.getElementById("frameContext").contentWindow.document;
  subdocument.open();
  subdocument.write('<!DOCTYPE HTML>');
  subdocument.write('<html>');
  subdocument.write('<head>');
  subdocument.write('<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />');
  subdocument.write('<title><Green Test Page</title>');
  subdocument.write('</head>');
  subdocument.write('<body style="background-color:#00FF00;">');
  subdocument.write('</body>');
  subdocument.write('</html>');
  subdocument.close();

  setTimeout(function() {
    keys = Object.keys(timing).sort();
    for (var i = 0; i < keys.length; ++i) {
      test_equals(timing[keys[i]], originalTiming[keys[i]],
                  keys[i] + " is the same after document open.");
    }
  }, 0);
}
</script>
</head>
<body>
<h1>Description</h1>
<p>This test validates window.performance.timing remains constant when a
document is replaced using document.open.</p>

<p>This page should be loaded with a yellow frame below. It then replaces the
document in that frame with a green document.</p>

<p>The test passes if all of the checks to performance.timing are correct and
the frame below ends with a green background.</p>

<div id="log"></div>
<br />
<iframe id="frameContext" onload="onload_test();" src="blank_page_yellow.htm" style="width: 250px; height: 250px;"></iframe>
</body>
</html>
