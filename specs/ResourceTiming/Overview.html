<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
  <meta content="text/html; charset=us-ascii" http-equiv="content-type">
  <title>Resource Timing</title>
<style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   pre code { color:inherit; background:transparent }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   .note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
   p.note::before { content:"Note: " }
   .XXX { padding:.5em; border:solid #f00 }
   p.XXX::before { content:"Issue: " }
   dl.switch { padding-left:2em }
   dl.switch > dt { text-indent:-1.5em }
   dl.switch > dt:before { content:'\21AA'; padding:0 0.5em 0 0; display:inline-block; width:1em; text-align:right; line-height:0.5em }
   dl.domintro { color: green; margin: 2em 0 2em 2em; padding: 0.5em 1em; border: none; background: #DDFFDD; }
   dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
   dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
   dl.domintro dd p { margin: 0.5em 0; }
   dl.domintro:before { display: table; margin: -1em -0.5em -0.5em auto; width: auto; content: 'This box is non-normative. Implementation requirements are given below this box.'; color: red; border: solid 2px; background: white; padding: 0 0.25em; }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   dfn { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   hr:not(.top) { display:block; background:none; border:none; padding:0; margin:2em 0; height:auto }
   table { border-collapse:collapse; border-style:hidden hidden none hidden }
   table thead { border-bottom:solid }
   table tbody th:first-child { border-left:solid }
   table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }
   div.parameters{ display:block; margin-left: 25px;}
   div.methods { display:block; margin-top:30px;margin-left :25px;}   
.style1 {
	font-family: monospace;
	color: orangered;
}
.style2 {
	color: #0000CC;
}
</style>
<link href="http://www.w3.org/StyleSheets/TR/W3C-ED.css" rel="stylesheet" type="text/css">
</head>

<body class="draft">

<div class="head">
<h1>Resource Timing</h1>

<h2 class="no-num no-toc" id="working-draft-march-07-2011">Working Draft March 7th, 2011</h2>
<dl>
  <dt>This version:</dt>
    <dd><a href="http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/ResourceTiming/Overview.html">http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/ResourceTiming/Overview.html</a></dd>
  <dt>Latest version:</dt>
      <dd><a href="http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/ResourceTiming/Overview.html">http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/ResourceTiming/Overview.html</a></dd>
  <dt>Previous versions:</dt>
    <dd><a href="https://dvcs.w3.org/hg/webperf/raw-file/f4afa13cc151/specs/NavigationTiming/Overview.html">https://dvcs.w3.org/hg/webperf/raw-file/f4afa13cc151/specs/NavigationTiming/Overview.html</a></dd>
    <dd><a href="https://dvcs.w3.org/hg/webperf/raw-file/10aa86c37245/specs/NavigationTiming/Overview.html">https://dvcs.w3.org/hg/webperf/raw-file/10aa86c37245/specs/NavigationTiming/Overview.html</a></dd>
  <dt>Editors:</dt>
    <dd class="vcard"><span class="fn">Jatinder Mann</span>, <span
      class="org">Microsoft Inc.</span>, <span
      class="email">jmann@microsoft.com</span> </dd>
    <dd class="vcard"><span class="fn">Anderson Quach</span>, <span
      class="org">Microsoft Inc.</span>, <span
      class="email">aquach@microsoft.com</span> </dd>
    <dd class="vcard"><span class="fn">Zhiheng Wang</span>, <span
      class="org">Google Inc.</span>, <span
      class="email">zhihengw@google.com</span> </dd>
</dl>

   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    &copy; 2010 <a href="http://www.w3.org/"><acronym title="World Wide Web
    Consortium">W3C</acronym></a><sup>&reg;</sup> (<a
    href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute
    of Technology">MIT</acronym></a>, <a
    href="http://www.ercim.org/"><acronym title="European Research Consortium
    for Informatics and Mathematics">ERCIM</acronym></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>

    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
</div>

<h2 class="no-num no-toc" id="abstract">Abstract</h2>

<p>This specification defines an interface for web applications to access
timing information related to HTML elements. </p>

<h2 class="no-num no-toc" id="status-of-this-document">Status of this
document</h2>

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index</a> at http://www.w3.org/TR/.</em></p>

<p>This is a <strong>work in progress</strong> and may change without any
notices. </p>

<p>Please send comments
   to <a href="mailto:public-web-perf@w3.org?subject=[NavigationTiming]%20">public-web-perf@w3.org</a>
   (<a href="http://lists.w3.org/Archives/Public/public-web-perf/">archived</a>)
   with <samp>[ResourceTiming]</samp> at the start of the subject line.</p>

<p>This document is produced by
   the <a href="http://www.w3.org/2010/webperf/">Web Performance</a>
   Working Group. The Web Performance Working Group is part of
   the <a href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients
   Activity</a> in the
   W3C <a href="http://www.w3.org/Interaction/">Interaction
   Domain</a>.

<p>Publication as a Working Draft does not imply endorsement by the
W3C Membership. This is a draft document and may be updated, replaced
or obsoleted by other documents at any time. It is inappropriate to
cite this document as other than work in progress. </p>

<p>This document was produced by a group operating under
   the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5
   February 2004 W3C Patent Policy</a>. W3C maintains
   a <a href="http://www.w3.org/2004/01/pp-impl/45211/status"
   rel="disclosure">public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also
   includes instructions for disclosing a patent. An individual who
   has actual knowledge of a patent which the individual believes
   contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance
   with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.</p>

<h2 class="no-num no-toc" id="table-of-contents">Table of Contents</h2>
<!--begin-toc-->
<ol class="toc">
  <li><a href="#introduction"><span class="secno">1
  </span>Introduction</a></li>
  <li><a href="#conformance-requirements"><span class="secno">2
    </span>Conformance requirements</a></li>
  <li><a href="#terminology"><span class="secno">3 </span>Terminology</a></li>
  <li><a href="#resource-timing-0"><span class="secno">4 </span>Resource
    Timing</a> 
    <ol class="toc">
      <li><a href="#introduction-1"><span class="secno">4.1
        </span>Introduction</a></li>
      <li><a href="#resourcetiming"><span class="secno">4.2
        </span>The <code>PerformanceResourceTiming</code> Interface</a></li>
      <li><a href="#resource-timing-methods"><span
        class="secno">4.3 </span> The Resource Timing Methods</a></li>
      <li><a href="#processing-model"><span class="secno">4.4
        </span>Processing Model</a></li>

    </ol>
  </li>
  <li><a href="#privacy"><span class="secno">5 </span>Privacy</a></li>
  <li><a href="#security"><span class="secno">6 </span>Security</a></li>
  <li><a class="no-num" href="#acknowledgements">Acknowledgements</a></li>
</ol>
<!--end-toc-->

<h2 id="introduction"><span class="secno">1 </span>Introduction</h2>

<p>This section is non-normative.</p>
User latency is an important quality benchmark for Web Applications. While
JavaScript-based mechanisms can provide comprehensive instrumentation for
user latency measurements within an application, in many cases, they are
unable to provide a complete end-to-end latency picture. While <a
href="http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/ResourceTiming/Overview.html">NavigationTiming</a> address
part of the problem by providing timing information associated with a
navigation, this document introduces the <a
href="http://pimpmyspec.net/aquarium.py/output?uri=http%3A%2F%2Fkvnwg.com%2FResourceTiming%2FOverview.html&amp;process_filter=on&amp;process_toc=on&amp;process_xref=on&amp;process_sub=on&amp;process_annotate=on&amp;filter=&amp;annotation=&amp;newline_char=LF&amp;tab_char=SPACE&amp;min_depth=2&amp;max_depth=6&amp;w3c_compat_xref_a_placement=on&amp;parser=lxml.html&amp;serializer=html5lib&amp;output_encoding=ascii#resource-timing">ResourceTiming</a>
interface to allow Javascript mechanisms to collect complete timing
information related to resources on a document. 

<div class="XXX">
<p>Add examples when the interface stabilizes.</p>
</div>

<div class="example">
<p></p>
</div>

<h2 id="conformance-requirements"><span class="secno">2 </span>Conformance
requirements</h2>

<p>All diagrams, examples, and notes in this specification are non-normative,
as are all sections explicitly marked non-normative. Everything else in this
specification is normative. </p>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHOULD", "SHOULD NOT",
"RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this document
are to be interpreted as described in RFC2119. For readability, these words
do not appear in all uppercase letters in this specification. <a
href="http://pimpmyspec.net/aquarium.py/output?uri=http%3A%2F%2Fkvnwg.com%2FResourceTiming%2FOverview.html&amp;process_filter=on&amp;process_toc=on&amp;process_xref=on&amp;process_sub=on&amp;process_annotate=on&amp;filter=&amp;annotation=&amp;newline_char=LF&amp;tab_char=SPACE&amp;min_depth=2&amp;max_depth=6&amp;w3c_compat_xref_a_placement=on&amp;parser=lxml.html&amp;serializer=html5lib&amp;output_encoding=ascii#references">[RFC2119]</a>
</p>

<p>Requirements phrased in the imperative as part of algorithms (such as
"strip any leading space characters" or "return false and abort these steps")
are to be interpreted with the meaning of the key word ("must", "should",
"may", etc) used in introducing the algorithm. </p>

<p>Some conformance requirements are phrased as requirements on attributes,
methods or objects. Such requirements are to be interpreted as requirements
on user agents. </p>

<p>Conformance requirements phrased as algorithms or specific steps may be
implemented in any manner, so long as the end result is equivalent. (In
particular, the algorithms defined in this specification are intended to be
easy to follow, and not intended to be performant.) </p>

<h2 id="terminology"><span class="secno">3 </span>Terminology</h2>

<p>The construction "a <code title="">Foo</code> object", where <code
title="">Foo</code> is actually an interface, is sometimes used instead of
the more accurate "an object implementing the interface <code
title="">Foo</code>". </p>

<p>The term DOM is used to refer to the API set made available to scripts in
Web applications, and does not necessarily imply the existence of an actual
<code>Document</code> object or of any other <code>Node</code> objects as
defined in the DOM Core specifications. <a
href="http://pimpmyspec.net/aquarium.py/output?uri=http%3A%2F%2Fkvnwg.com%2FResourceTiming%2FOverview.html&amp;process_filter=on&amp;process_toc=on&amp;process_xref=on&amp;process_sub=on&amp;process_annotate=on&amp;filter=&amp;annotation=&amp;newline_char=LF&amp;tab_char=SPACE&amp;min_depth=2&amp;max_depth=6&amp;w3c_compat_xref_a_placement=on&amp;parser=lxml.html&amp;serializer=html5lib&amp;output_encoding=ascii#references">[DOM3CORE]</a>
</p>

<p>A DOM attribute is said to be <em>getting</em> when its value is being
retrieved (such as by author script), and is said to be <em>setting</em> when
a new value is assigned to it. </p>

<p>The term "JavaScript" is used to refer to ECMA262, rather than the
official term ECMAScript, since the term JavaScript is more widely known. <a
href="http://pimpmyspec.net/aquarium.py/output?uri=http%3A%2F%2Fkvnwg.com%2FResourceTiming%2FOverview.html&amp;process_filter=on&amp;process_toc=on&amp;process_xref=on&amp;process_sub=on&amp;process_annotate=on&amp;filter=&amp;annotation=&amp;newline_char=LF&amp;tab_char=SPACE&amp;min_depth=2&amp;max_depth=6&amp;w3c_compat_xref_a_placement=on&amp;parser=lxml.html&amp;serializer=html5lib&amp;output_encoding=ascii#references">[ECMA262]</a>
</p>

<p>Without otherwise specified, in rest of this work, time is measured in milliseconds since midnight of January 1, 1970 (UTC).</p>

<h2 id="resource-timing-0"><span class="secno">4 </span>Resource Timing</h2>

<h3 id="introduction-1"><span class="secno">4.1 </span>Introduction</h3>

<p>This section is non-normative</p>

<p>The <a href="#performance-resource-timing">PeformanceResourceTiming</a>
interface facilitates timing measurement of resources on the root page. It
represents the timing information related to an <a
href="http://dev.w3.org/html5/spec/Overview.html#elements">element</a>. 
This interface is available for
<a href="http://www.w3.org/TR/XMLHttpRequest/">XMLHttpRequest</a> and the following
HTML elements:
<a href="http://dev.w3.org/html5/spec/Overview.html#the-iframe-element">iframe</a>,
<a href="http://dev.w3.org/html5/spec/Overview.html#the-img-element">img</a>,
<a href="http://dev.w3.org/html5/spec/Overview.html#script">script</a>,
<a href="http://dev.w3.org/html5/spec/Overview.html#the-object-element">object</a>,
<a href="http://dev.w3.org/html5/spec/video.html#audio">audio</a>,
<a href="http://dev.w3.org/html5/spec/video.html#video">video</a>,
<a href="http://dev.w3.org/html5/spec/Overview.html#the-embed-element">embed</a>
and <a
href="http://dev.w3.org/html5/spec/Overview.html#the-link-element">link</a>
with the link type of <a
href="http://dev.w3.org/html5/spec/Overview.html#link-type-stylesheet">stylesheet</a>.</p>

<p>The term "resource" is also used to refer to these elements in this work. </p>
</div>

<div class="note">
<p>TODO: make availability a normative requirement.</p>
</div>

<div class="head">
<h3 id="the-resourcetiming-interface"><span class="secno">4.2 </span>The
<code><a href="#resource-timing">PerformanceResourceTiming</a></code> Interface</h3>
<pre class="idl">interface <a href="#resource-timing">PerformanceResourceTiming</a> {
  readonly attribute DOMString <a href="#rt-allowed-domains">allowedDomains</a>;

  const unsigned short <a href="#resource-type-other">RESOURCE_OTHER</a> = 0;
  const unsigned short <a href="#resource-type-link-css">RESOURCE_LINK_CSS</a> = 1;
  const unsigned short <a href="#resource-type-cssimage">RESOURCE_CSSIMAGE</a> = 2;
  const unsigned short <a href="#resource-type-script">RESOURCE_SCRIPT</a> = 3;
  const unsigned short <a href="#resource-type-image">RESOURCE_IMAGE</a> = 4;
  const unsigned short <a href="#resource-type-object">RESOURCE_OBJECT</a> = 5;
  const unsigned short <a href="#resource-type-frame">RESOURCE_FRAME</a> = 6;
  const unsigned short <a href="#resource-type-subdocument">RESOURCE_SUBDOCUMENT</a> = 7;
  const unsigned short <a href="#resource-type-xhr">RESOURCE_XMLHTTPREQUEST</a> = 8;
  const unsigned short <a href="#resource-type-embed">RESOURCE_EMBED</a> = 9;
  const unsigned short <a href="#resource-type-audio">RESOURCE_AUDIO</a> = 10;
  const unsigned short <a href="#resource-type-video">RESOURCE_VIDEO</a> = 11;
  const unsigned short <a href="#resource-type-reserved">RESOURCE_RESERVED</a> = 255;  
  
  readonly attribute unsigned short <a href="#resource-type" title="resourcetype">resourceType</a>;
  
  readonly attribute DOMString <a href="#url" title="url">url</a>;
  readonly attribute unsigned long long <a href="#redirect-start" title="redirectstart">redirectStart</a>;
  readonly attribute unsigned long long <a href="#redirect-end" title="redirectend">redirectEnd</a>;
  readonly attribute unsigned long long <a href="#fetch-start" title="fetchstart">fetchStart</a>;
  readonly attribute unsigned long long <a href="#domain-lookupstart" title="domainlookupstart">domainLookupStart</a>;
  readonly attribute unsigned long long <a href="#domain-lookupend" title="domainlookupend">domainLookupEnd</a>;
  readonly attribute unsigned long long <a href="#connect-start" title="connectstart">connectStart</a>;
  readonly attribute unsigned long long <a href="#connect-end" title="connectend">connectEnd</a>;
  readonly attribute unsigned long long <a href="#request-start" title="requeststart">requestStart</a>;
  readonly attribute unsigned long long <a href="#request-end" title="requestend">requestEnd</a>;
  readonly attribute unsigned long long <a href="#response-start" title="responsestart">responseStart</a>;
  readonly attribute unsigned long long <a href="#response-end" title="responseend">responseEnd</a>;
  readonly attribute unsigned long long <a href="#load-start" title="loadeventstart">loadEventStart</a>;
  readonly attribute unsigned long long <a href="#load-end" title="loadeventend">loadEventEnd</a>;  
};</pre>

<h4 id="alloweddomain-attribute"><code><dfn
id="rt-allowed-domains">allowDomain</dfn></code> attribute</h4>

<p>This attribute is used to indicate the domains that can access the
ResourceTiming object. If the current document has a meta element whose name
attribute is "timing-allowed-domains", this attribute must return its
corresponding content attribute. It must return an empty string if there is no
meta element whose name attribute is "timing-allow-domains". </p>

<div class="example">
<p>To allow any pages from either foo.com or bar.net to access the
ResourceTiming objects of a resource, the following statement needs to be
added into the resource's HTML header: </p>
<pre>&lt;meta name="timing-allowed-domains" content="foo.com,bar.net"&gt;&lt;/pre&gt;</pre>
</div>

<div class="note">
<p>TODO: The exact mechanism of the access control is TBD.</p>
</div>

<h4 id="resourcetype-attribute"><code><dfn id="resource-type">resourceType</dfn></code> attribute</h4>

<p>This attribute must return one of the following <a href="#resource-type">resource types</a>: </p>
<dl>
  <dt><dfn id="resource-type-other">RESOURCE_OTHER</dfn>: the resource is not of any type listed below.</dt>
  <dt><dfn id="rt-initiator-type-link-css">RESOURCE_LINK_CSS</dfn>: the resource is an external cascading stylesheet.</dt>
  <dt><dfn id="resource-type-cssimage">RESOURCE_CSSIMAGE</dfn>: the resource is a CSS image.</dt>
  <dt><dfn id="resource-type-script">RESOURCE_SCRIPT</dfn>: the resource is script.</dt>
  <dt><dfn id="resource-type-image">RESOURCE_IMAGE</dfn>: the resource is an image.</dt>
  <dt><dfn id="rt-resource-type-object">RESOURCE_OBJECT</dfn>: the resource is an object.</dt>
  <dt><dfn id="resource-type-cssimage">RESOURCE_FRAME</dfn>: the resource is a frame.</dt>
  <dt><dfn id="rt-resource-type-subdocument">RESOURCE_SUBDOCUMENT</dfn>: the resource is a document.</dt>
  <dt><dfn id="rt-resource-type-xhr">RESOURCE_XMLHTTPREQUEST</dfn>: the resource is an XML HTTP request.</dt>
  <dt><dfn id="rt-resource-type-embed">RESOURCE_EMBED</dfn>: the resource is an embed.</dt>
  <dt><dfn id="rt-resource-type-audio">RESOURCE_AUDIO</dfn>: the resource is an audio element.</dt>
  <dt><dfn id="rt-resource-type-audio">RESOURCE_VIDEO</dfn>: the resource is a video element.</dt>
  <dt><dfn id="rt-resource-type-audio">RESOURCE_RESERVED</dfn>: this is reserved for future use.</dt>
</dl>

<h4 id="url-attribute"><code><dfn id="rt-url">url</dfn></code> attribute</h4>

<p>This attribute must return the <a
href="http://dev.w3.org/html5/spec/Overview.html#url">URL</a> of the
associated resource.</p>

<h4 id="fetch-start"><code><dfn
id="rt-fetch-start">fetchStart</dfn></code> attribute</h4>

<p>This attribute must return the time immediately before the user agent starts to <a
href="http://dev.w3.org/html5/spec/Overview.html#fetching-resources">fetch</a>
the resource. This time should not be overwritten if the user agent retries
fetching the same resource due to failures. When a resource is set or changed
and if it results in a <a
href="http://dev.w3.org/html5/spec/Overview.html#fetch">fetch</a>, its timing
attribute must be updated.</p>

<h4 id="domain-lookup-start"><code><dfn
id="domain-lookup-start">domainLookupStart</dfn></code> attribute</h4>

<p>This attribute must return the time immediately before the user agent starts
the domain name lookup for the resource.
If a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
connection</a> [<a href='#rfc2616'>RFC 2616</a>] is used or the resource
is retrieved from <a href="http://dev.w3.org/html5/spec/offline.html#relevant-application-cache">relevant
application caches</a> or local resources, this attribute must return the same
value as <a href="#fetch-start">fetchStart</a>. </p>

<h4 id="domain-lookup-end"><code><dfn id="domain-lookup-end">domainLookupEnd</dfn></code> attribute</h4>

<p>This attribute must return the time immediately after the user agent finishes
the domain name lookup for the resource.
If a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
connection</a> [<a href='#rfc2616'>RFC 2616</a>] is used or the resource
is retrieved from <a href="http://dev.w3.org/html5/spec/offline.html#relevant-application-cache">relevant
application caches</a> or local resources, this attribute must return the same
value as <a href="#fetch-start">fetchStart</a>. </p>

<p>If the user agent has the domain information in cache,
domainLookupStart and domainLookupEnd represent the times when the user agent
starts and ends the domain data retrieval from the cache. </p>

<h4 id="connect-start"><code><dfn id="connect-start">connectStart</dfn></code> attribute</h4>

<p>This attribute must return the time immediately before the user agent start
establishing the connection to the server to retrieve the resource. 
If a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
connection</a> [<a href='#rfc2616'>RFC 2616</a>] is used or the resource is retrieved from <a
href="http://dev.w3.org/html5/spec/offline.html#relevant-application-cache">relevant
application caches</a> or local resources, this attribute must return value of 
<a href="#domain-lookup-end">domainLookupEnd</a>.</p>

<h4 id="connect-end"><code><dfn
id="connect-end">connectEnd</dfn></code> attribute </h4>

<p>This attribute must return the time immediately after the user agent finishes
establishing the connection to the server to retrieve the resource.
If a <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
connection</a> [<a href='#rfc2616'>RFC 2616</a>] is used or the resource is retrieved from <a
href="http://dev.w3.org/html5/spec/offline.html#relevant-application-cache">relevant
application caches</a> or local resources, this attribute must return the value of
<a href="#nt-domain-lookup-end">domainLookupEnd</a>.</p>

<p>If the transport connection fails and the user agent reopens a connection,
<a href="#connect-start">connectStart</a> and <a
href="#connect-end">connectEnd</a> should return the corresponding
values of the new connection. </p>

<p><a href="#connect-end">connectEnd</a> must include the time interval to
establish the transport connection. It must not include other time interval
such as SSL handshake and SOCKS authentication. </p>

<h4 id="request-start"><code><dfn id="request-start">requestStart</dfn></code> attribute</h4>

<p>This attribute must return the time immediately before the user agent
starts requesting the resource. It is set prior to checking HTTP cache.</p>

<p>If the transport connection fails after a request is sent and the user
agent reopens a connection and resend the request, <a
href="#request-start">requestStart</a> must return the corresponding values
of the new request.</p>

<h4 id="response-start"><code><dfn id="response-start">responseStart</dfn></code> attribute </h4>

<p>This attribute must return the time immediately after the user agent receives
the first byte of the response from the server, or from <a
href="http://www.whatwg.org/specs/web-apps/current-work/#relevant-application-cache">relevant
application caches</a> or from local resources.</p>

<h4 id="response-end"><code><dfn id="response-end">responseEnd</dfn></code> attribute </h4>

<p>This attribute must return the time immediately after the user agent finishes
receiving the last byte of the resource from from <a
href="http://www.whatwg.org/specs/web-apps/current-work/#relevant-application-cache">relevant
application caches</a> or from local resources.</p>

<h4 id="load-event-start"><code><dfn id="rt-load-start">loadEventStart</dfn></code> attribute</h4>

<p>This attribute must return the time immediately before the load event of the
the resource is fired. It must return zero when the load event is not fired
yet.</p>

<h4 id="load-event-end"><code><dfn id="load-event-end">loadEventEnd</dfn></code> attribute</h4>

<p>This attribute must return the time immediately after the load event of the
resource is completed. It must return zero when the load event is not fired yet.</p>

<!--
<h3 id="the-resourcetimingcollector-interface"><span class="secno">4.3
</span> The <code><dfn
id="resourcetimingcollector">ResourceTimingCollector</dfn></code>
interface</h3>
<pre class="idl">interface ResourceTimingEvent : Event {
 readonly attribute array[ResourceTiming] timing;
};

interface ResourceTimingCollector {
  void addEventListener(in EventListener listener);
  void removeEventListener(in EventListener listener);
};

[Supplemental]
interface Performance {
  ResourceTimingCollector createResourceTimingCollector();
};</pre>

<p></p>

<p>ResourceTiming objects associated with embedded objects on the root
document must be saved until the root document completes loading. If a
ResourceTimingCollector object is created and an event handler is registered
using addEventListener before the root document completes loading, all
ResourceTiming objects must be delivered to the handler. If a
ResourceTimingCollector object is created after the root document finishes
loading, subsequent events should be delivered to the registered handlers as
they occur. </p>

<div class="example">

<div class="exampleHeader">
Example</div>

<p>Any ResourceTiming object created prior to the end of onload will receive
events for all resources (even if they complete prior to the object's
creation). If a ResourceTiming object is created after onload, it will only
receive events about resources completed after the object's creation. This
allows the browser optimal opportunities to garbage collect. </p>
</div>

<h3 id="rt-performanceresourcetiming-interface">
	<span class="secno">4.4 </span>The 
	<code><dfn id="resourcetimingcollector">PerformanceResourceTiming</dfn></code>
	 Interface (An alternate approach)
</h3>
-->

<h3 id="the-resourcetiming-interface"><span class="secno">4.3 </span>The Resource Timing Methods</h3>

<pre class="idl">
[Supplemental] Performance {
  void clearResourceTimings();
  PerformanceResourceTimingList getResourceTimings ([optional] in unsigned short initiatorType);
  PerformanceResourceTimingList getResourceTimingsByID( in DOMString id );
  PerformanceResourceTimingList getResourceTimingsByLocation( in Location location );
  void setResourceTimingBufferSize (in unsigned long length);
  
  attribute Function onbufferfull;
};</pre>
<pre class="idl">
interface PerformanceResourceTimingList{
   readonly attribute unsigned long length;
   getter ResourcePerformanceTiming(in unsigned long index);
};
</pre>

<div class="methods">
    <h4 id="rt-clearResourceTimings"><code>clearResourceTimings</code> method</h4>
	<p>The method <code>clearResourceTimings</code> clears the buffered array used to store a list of <code>PerformanceResourceTiming</code>.  Only the first 1000 <code>PerformanceResourceTiming</code> will be stored. Unless otherwise specified by <code>setResourceTimingBufferSize()</code>.</p>
		<div class="parameters">
			<p><b>No parameters</b></p>
			<p><b>No return value</b></p>
			<p><b>No exceptions</b></p>
		</div>
</div>

<div class="methods">
	<h4 id="rt-getResourceTimings"><code>getResourceTimings</code> method</h4>
	<p>The <code>getResourceTimings</code> interface retrieves a buffered array of <code>PerformanceResourceTiming</code> as stored by the user agent. When supplied with an <code>initiatorType</code>, this will return a filtered list. When the origin of the root document differs from that of the resources, only fetchStart and if available, fetchEnd, loadEventStart and loadEventEnd are available, otherwise all attributes are available.</p>
		<div class="parameters">
			<p><b>Parameters</b></p>
			[optional] in <code>initiatorType</code> type of unsigned short
			<p>The initiatorType parameter specifies which resource types to retrieve. If no initiatorType is supplied all resource timings are returned.</p>
			<p><b>Return Value</b></p>
			<p><code>PerformanceResourceTimingList</code></p>
			<p>A list of <code>PerformanceResourceTiming</code>.</p>
			<p><b>No exceptions</b></p>
		</div>
</div>

<div class="methods">
	<h4 id="rt-getResourceTimingsById"><code>getResourceTimingsById</code> method</h4>
	<p>The <code>getResourceTimingsById</code> interface retrieves a buffered array of <code>PerformanceResourceTiming</code> as as identified by the id and stored by the user agent. This will return a filtered list of Resource Timings as identified by the <code>id</code>.</p>
	<p>The default number of buffers returned is a MAX of 1000 PerformanceResourceTiming.</p>	
		<div class="parameters">
			<p><b>Parameters</b></p>
			in <code>id</code> type of <a class="noxref" href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMString">DOMString</a>
			<p>The id parameter specifies which resource timings to retrieve.</p>
			<p><b>Return Value</b></p>
			<p><code>PerformanceResourceTimingList</code></p>
			<p>A list of <code>PerformanceResourceTiming</code>.</p>
			<p><b>No exceptions</b></p>
		</div>
</div>

<div class="methods">
	<h4 id="rt-getResourceTimingsByLocation"><code>getResourceTimingsByLocation</code> method</h4>
	<p>The <code>getResourceTimingsByLocation</code> interface retrieves a buffered array of <code>PerformanceResourceTiming</code> stored by the user agent and identified by a location. This will return a filtered list of Resource Timings as identified by the location.</p>
	<p>The default number of buffers returned is a MAX of 1000 PerformanceResourceTiming.</p>	
		<div class="parameters">
			<p><b>Parameters</b></p>
			in <span class="style1">location</span> type of 
			<a href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#Interfaces-DOMLocator">
			<span class="style2">DOMLocator</span></a>
			<p>The id parameter specifies which resource timings to retrieve.</p>
			<p><b>Return Value</b></p>
			<p><code>PerformanceResourceTimingList</code></p>
			<p>A list of <code>PerformanceResourceTiming</code>.</p>
			<p><b>No exceptions</b></p>
		</div>
</div>

<div class="methods">
	<h4 id="rt-setResourceTimingBufferSize"><code>setResourceTimingBufferSize</code> method</h4>
	<p>The method <code>setResourceTimingBufferSize</code> is a setter that expands the buffered array used to store a list of <code>PerformanceResourceTiming</code>.</p>
	<p>If this method is not called, the default number of buffers stored is a MAX of 1000 PerformanceResourceTiming.</p>	
		<div class="parameters">
			<p><b>Parameters</b></p>
			in <code>length</code> type of unsigned long
			<p>The length parameter allows the site developer to specify a buffer size that is greater or smaller than the default of 1000 <code>PerformanceResourceTiming</code>.</p>
			<p><b>No return value</b></p>
			<p><b>No exceptions</b></p>
		</div>
</div>
	
<div class="methods">
	<h4 id="rt-onbufferfull"><code>onbufferfull</code> attribute</h4>
	<p>The callback onbufferfull is triggered when the buffer used to store a list of <code>PerformanceResourceTiming</code> is full. The callback can be used to package existing <code>PerformanceResourceTiming</code> list and clear the buffered <code>PerformanceResourceTiming</code> list. While executing the onbufferfull callback, <code>PerformanceResourceTiming</code> will continue to be collected beyond the initial restriction of the first 1000 <code>PerformanceResourceTiming</code> until one of the following occurs:
		<ol>
		<li><code>clearResourceTimings()</code> is called - The PerformanceResourceTimingList will begin with the 1001th item if it exists and the first 1000 elements are released. If the 1001th item does not exist the buffer is cleared. The max length of the PerformanceResourceTimingList is still 1000 unless otherwise specified by setResourceTimingBufferSize().</li>
		<li><code>setResourceTimingBufferSize()</code> is called - The PerformanceResourceTimingList will extend and / or truncate to the buffer size specified.</li>
		<li>Neither <code>clearResourceTimings()</code> or <code>setResourceTimingBufferSize()</code> is called during the execution of the onbufferfull callback 
		- no updates are made to the PerformanceResourceTimingList.</li>
		</ol>
	</p>
</div>

<!--	
<h4 id="initatortype-attribute"><code><dfn
id="rt-initatortype">initatorType</dfn></code> attribute</h4>

<p>This attribute stores the initator of the resource download. For example with a CSS stylesheet, the initator type will be RESOURCE_LINK_CSS.</p>

<dl>
  <dt><dfn id="rt-initiator-type-other">RESOURCE_OTHER</dfn>: the initator
  is not a known initator type.</dt>
  <dt><dfn id="rt-initiator-type-link-css">RESOURCE_LINK_CSS</dfn>: the resource is
  an external cascading stylesheet.</dt>
  <dt><dfn id="rt-initiator-type-cssimage">RESOURCE_CSSIMAGE</dfn>: the
  resource is a CSS image.</dt>
  <dt><dfn id="rt-initiator-type-script">RESOURCE_SCRIPT</dfn>: the
  resource is a script.</dt>
  <dt><dfn id="rt-initiator-type-img">RESOURCE_IMG</dfn>: the resource
  is an image.</dt>
  <dt><dfn id="rt-initiator-type-object">RESOURCE_OBJECT</dfn>: the
  resource is an object.</dt>
  <dt><dfn id="rt-initiator-type-frame">RESOURCE_FRAME</dfn>: the
  resource is a sub-document such as a frame or iframe.</dt>
  <dt><dfn id="rt-initiator-type-xhr">RESOURCE_XMLHTTPREQUEST</dfn>: the
  resource is a XML HTTP request.</dt>
  <dt><dfn id="rt-initiator-type-embed">RESOURCE_EMBED</dfn>: the
  resource is an embed resource.</dt>
  <dt><dfn id="rt-initiator-type-audio">RESOURCE_AUDIO</dfn>: the
  resource is an audio resource.</dt>
  <dt><dfn id="rt-initiator-type-video">RESOURCE_VIDEO</dfn>: the
  resource is a video resource.</dt>
  <dt><dfn id="rt-initiator-type-ms-htc">RESOURCE_RESERVED_MS_HTC</dfn>: the
  resource is a Microsoft HTC resource.</dt>  
</dl>

<h4 id="fetchend-attribute"><code><dfn
id="rt-fetchend">fetchEnd</dfn></code> attribute</h4>

<p>This attribute must return the time immediately after the user agent receives the last byte of the response of the resource from the server.</p>
-->


<h3 id="processing-model"><span class="secno">4.4 </span>Processing Model</h3>

<div class="XXX">
TODO: to handle dynamic sources such as those generated by DOM
manipulation or innerHTML replacement. </div>

<div class="XXX">
TODO: Processing model should be similar to that described in the
<a href="https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/NavigationTiming/Overview.html">
NavigationTiming</a> draft.</div>

<p>A user agent must allocate space to store all the <a
href="#resource-timing">ResourceTiming</a> objects generated in the following
process. </p>
<ol>
  <li>Before a user agent fetches a resource for an element that associates
    with a ResourceTiming object, the following steps must be run: 
    <ol>
      <li>Create a new <a href="#resource-timing">ResourceTiming</a>
      object.</li>
      <li>Record the <a href="#rt-resource-type">resourceType</a>
      attribute.</li>
      <li>Before a user agent runs the <a
        href="http://dev.w3.org/html5/spec/Overview.html#changesToNetworkingModel">fetching
        algorithm</a>, it must record the current time in the <a
        href="#nt-fetch-start">fetchStart</a> attribute.</li>
      <li>Record the time as <a href="#rt-load">load</a> attribute
        immediately after the user agent finishes loading the resource into
        DOM.</li>
      <li>If a ResourceTimingCollector object exists, dispatch a
        ResourceTimingEvent with the ResourceTiming object to all registered
        event handlers.</li>
      <li>Save the ResourceTiming object unless the root document has
        finished loading.</li>
    </ol>
  </li>
  <li>When an event handler is added by <a href="">addEventListener</a>, the
    user agent must check if there is any saved <a
    href="#resource-timing">ResourceTiming</a> objects. If so, it must
    dispatch a ResourceTimingEvent to this new event handler and pass it with
    all the ResourceTiming objects.</li>
  <li>After the root document is loaded and the <a
    href="http://dev.w3.org/html5/spec/webappapis.html#handler-window-onload">onload</a>
    event is handled, a user agent may discard all the <a
    href="#resource-timing">ResourceTiming</a> objects it saves. All these
    objects must not be discarded before this time.</li>
  <li>Saved <a href="#resource-timing">ResourceTiming</a> objects should be
    cleaned up during the <a
    href="http://dev.w3.org/html5/spec/history.html#unloading-document-cleanup-steps">unloading
    document cleanup steps</a>.</li>
</ol>

<div class="example">

<div class="exampleHeader">
Example</div>

<p>To avoid maintaining its own data storage while collecting timing
information of all the resources, a page can create the
ResourceTimingCollector and register the ResourceTimingEvent handler in the
body onload handler. </p>
</div>

<p>The accuracy of the timing-related attributes in the
<a href="#resource-timing">ResourceTiming</a> interfaces is recommended to be
one millisecond or finer. </p>

<h2 id="privacy"><span class="secno">5 </span>Privacy</h2>

<p>This section is non-normative.</p>

<p>When giving various timing information of how a resource is requested and
process, the <a href="#resource-timing">ResourceTiming</a> potentially
exposes such information to any page that has this resource included. To
limit the access to the ResourceTiming interface, the <a
href="http://dev.w3.org/html5/spec/origin-0.html#origin">same origin</a>
policy is enforced by default. Additionally, resource providers can
explicitely allow timing information to be collected over a resource by
adding the allow-timing meta tag to the HTML header, which specifies the
domains that are allowed to access the timing information. </p>

<h2 id="security"><span class="secno">6 </span>Security</h2>

<p>This section is non-normative.</p>

<p>Similar to the discussion in the Privacy section. </p>

<h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

<p>We would like to sincerely thank Annie Sullivan, Darin Fisher, Jason
Weber, Jonas Sicking, Kyle Scholz, Steve Souders and Tony Gentilcore to
acknowledge their contributions to this work.</p>
</div>
</body>
</html>
