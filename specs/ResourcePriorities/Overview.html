<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Resource Priorities</title>
<style>
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   pre code { color:inherit; background:transparent }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   .note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
   p.note::before { content:"Note: " }
   .XXX { padding:.5em; border:solid #f00 }
   p.XXX::before { content:"Issue: " }
   dl.switch { padding-left:2em }
   dl.switch > dt { text-indent:-1.5em }
   dl.switch > dt:before { content:'\21AA'; padding:0 0.5em 0 0; display:inline-block; width:1em; text-align:right; line-height:0.5em }
   dl.domintro { color: green; margin: 2em 0 2em 2em; padding: 0.5em 1em; border: none; background: #DDFFDD; }
   dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
   dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
   dl.domintro dd p { margin: 0.5em 0; }
   dl.domintro:before { display: table; margin: -1em -0.5em -0.5em auto; width: auto; content: 'This box is non-normative. Implementation requirements are given below this box.'; color: red; border: solid 2px; background: white; padding: 0 0.25em; }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   dfn { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   hr:not(.top) { display:block; background:none; border:none; padding:0; margin:2em 0; height:auto }
   table { border-collapse:collapse; border-style:hidden hidden none hidden }
   table thead { border-bottom:solid }
   table tbody th:first-child { border-left:solid }
   table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }
  .auto-style1 { background-color: #FFFFFF;}
  .ednote { border-top: 3px solid red; border-bottom: 3px solid red; margin: 1em 2em; padding: 0 1em 0 1em; background: #f8eeee }
  .ednoteHeader { font-weight: bold; display: block; padding-top: 0.5em }
  </style>
  <link href="https://www.w3.org/StyleSheets/TR/W3C-ED.css" rel="stylesheet" type="text/css">

</head>

<body class="draft">

<div class="head">
<h1>Resource Priorities</h1>

<h2 class="no-num no-toc" id="editors-draft-april-17-2013">Editor's Draft April 17, 2013</h2>
<dl>
  <dt>This version:</dt>
    <dd><a
      href="http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/ResourcePriorities/Overview.html">http://dvcs.w3.org/hg/webperf/raw-file/tip/specs/ResourcePriorities/Overview.html</a></dd>
  <dt>Editors:</dt>
    <dd class="vcard"><span class="fn">Jatinder Mann</span>, <span
      class="org">Microsoft Corp.</span>, &lt;<a
      class="email" href="mailto:jmann@microsoft.com">jmann@microsoft.com</a>&gt; </dd>
	  <dd class="vcard"><span class="fn">James Simonsen</span>, <span
      class="org">Google Inc.</span>, &lt;<a
      class="email" href="mailto:simonjam@google.com">simonjam@google.com</a>&gt; </dd>
</dl>

   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    &copy; 2012 <a href="http://www.w3.org/"><abbr title="World Wide Web
    Consortium">W3C</abbr></a><sup>&reg;</sup> (<a
    href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute
    of Technology">MIT</abbr></a>, <a
    href="http://www.ercim.eu/"><abbr title="European Research Consortium
    for Informatics and Mathematics">ERCIM</abbr></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>

    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>

   <hr class='top'>
</div>

<h2 class="no-num no-toc" id="abstract">Abstract</h2>

<p>
    This specification defines a means for site developers to programmatically give the User Agent
    hints on the download priority of a resource. This will allow User Agents to more efficiently
    manage the order in which resources are downloaded.
</p>

<h2 class="no-num no-toc" id="status-of-this-document">Status of this
document</h2>

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index</a> at http://www.w3.org/TR/.</em></p>

<p>This is a <strong>work in progress</strong> and may change without any
notices. </p>

<p>Please send comments
   to <a href="mailto:public-web-perf@w3.org?subject=%5BResourcePriorities%5D%20">public-web-perf@w3.org</a>
   (<a href="http://lists.w3.org/Archives/Public/public-web-perf/">archived</a>)
   with <samp>[ResourcePriorities]</samp> at the start of the subject line.</p>

<p>This document is produced by
   the <a href="http://www.w3.org/2010/webperf/">Web Performance</a>
   Working Group. The Web Performance Working Group is part of
   the <a href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients
   Activity</a> in the
   W3C <a href="http://www.w3.org/Interaction/">Interaction
   Domain</a>.

<p>Publication as a Working Draft does not imply endorsement by the
W3C Membership. This is a draft document and may be updated, replaced
or obsoleted by other documents at any time. It is inappropriate to
cite this document as other than work in progress. </p>

<p>This document was produced by a group operating under
   the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5
   February 2004 W3C Patent Policy</a>. W3C maintains
   a <a href="http://www.w3.org/2004/01/pp-impl/45211/status">public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also
   includes instructions for disclosing a patent. An individual who
   has actual knowledge of a patent which the individual believes
   contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance
   with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.</p>


<h2 class="no-num no-toc" id="table-of-contents">Table of Contents</h2>
<!--begin-toc-->
<ol class="toc">
  <li><a href="#introduction"><span class="secno">1
  </span>Introduction</a></li>
  <li><a href="#conformance-requirements"><span class="secno">2
    </span>Conformance requirements</a></li>
  <li><a href="#terminology"><span class="secno">3 </span>Terminology</a></li>
  <li><a href="#sec-resource-priorities"><span class="secno">4 </span>Resource Priorities</a> 
    <ol class="toc">
      <li><a href="#sec-resource-priorities-introduction"><span class="secno">4.1 </span>Introduction</a></li>
      <li><a href="#sec-defer-attribute"><span class="secno">4.2 </span><code>defer</code> Attribute</li>
    </ol>
  </li>
  <li><a href="#references"><span class="secno">6 </span>References</a></li>
  <li><a class="no-num" href="#acknowledgements">Acknowledgements</a></li>
</ol>
<!--end-toc-->

<h2 id="introduction"><span class="secno">1 </span>Introduction</h2>

<p>This section is non-normative.</p>

<p>
    The Resource Priorities specification defines a means for site developers to programmatically give 
    the User Agent hints on the download priority of a resource. Without knowing the download priority of 
    a resource, the User Agent will typically download resources in document order. However, the download
    order may not be best optimized for improving the perception of page load performance.
</p>
<p>
    For example, a site developer may want to improve the perception of page load performance by
    optimizing the download of resources that are required to create the above the fold visuals for a web page.
    However, determining which resources are required to create the above the fold visuals for a web page
    is something the User Agent cannot easily determine on its own. Instead, the site developer is in the
    best position to let the User Agent know the relative priorities of resources on the page.
</p>
<div class="example">
    <p>
        The following example shows a theoretical web page that doesn't specify the download priority of resources.
        In this example, the site developer will use Stylesheets from Styles.css and script within Visuals.js 
        to re-layout the page such that Logo.png, Header.png, and MainContent.mp4 will be shown above the fold, 
        whereas AdditionalImages1.png and AdditionalImages2.png will be shown below the fold. Animations.css is used
        to display an animation when a user clicks on an image and Analytics.js is used to collect analytics information.
    </p>
<pre>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
 &lt;head&gt;
     &lt;link rel="stylesheet" type="text/css" href="Styles.css" /&gt;
     &lt;link rel="stylesheet" type="text/css" href="Animations.css" /&gt;
 &lt;/head&gt;
 &lt;body&gt;
    &lt;img id="Logo" href=".../images/Logo.png"/&gt;
    &lt;img id="Header" href=".../images/Header.png"/&gt;
    &lt;img id="AdditionalImages1" href=".../images/AdditionalImages1.png"/&gt;
    &lt;img id="AdditionalImages2" href=".../images/AdditionalImages2.png"/&gt;
    &lt;video id="MainContent" href=".../videos/MainContent.mp4"/&gt;
    &lt;script src="Visuals.js" &gt;&lt;/script&gt;
    &lt;script src="Analytics.js" &gt;&lt;/script&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>
</div>

<p>
    As the example page has been specified, a User Agent may download resources in the following order: root document, 
    CSS in document order, JavaScript in document order, and everything else in document order. In this case, 
    AdditionalImages1.png and AddtionalImages.png will be downloaded before MainContent.mp4, even though they will not 
    be displayed above the fold when the page loads. Additionally, Animations.css and Analytics.js will be downloaded 
    prior to the visual aspect of the page, even though they won't be used in the page load sequence.
</p>

<p>
    Using the <a href="#dom-defer"><code>defer</code></a> attribute on a resource will signal to the User Agent that
    it may want to lower the download priority of that resource.
</p>
 
<div class="example">
<p>
    The following example shows the same theoretical web page but with the <code>defer</code> attribute set for
    resources whose download priority can be reduced, as they do not impact the visual appearance of the page
    above the fold.
</p>
<pre>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
 &lt;head&gt;
     &lt;link rel="stylesheet" type="text/css" href="Styles.css" /&gt;
     &lt;link rel="stylesheet" type="text/css" href="Animations.css" defer /&gt;
 &lt;/head&gt;
 &lt;body&gt;
    &lt;img id="Logo" href=".../images/Logo.png"/&gt;
    &lt;img id="Header" href=".../images/Header.png"/&gt;
    &lt;img id="AdditionalImages1" href=".../images/AdditionalImages1.png" defer /&gt;
    &lt;img id="AdditionalImages2" href=".../images/AdditionalImages2.png" defer /&gt;
    &lt;video id="MainContent" href=".../videos/MainContent.mp4"/&gt;
    &lt;script src="Visuals.js" &gt;&lt;/script&gt;
    &lt;script src="Analytics.js" defer &gt;&lt;/script &gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>
</div>

<p>
    In this example page, using the <a href="#dom-defer"><code>defer</code></a> attribute 
    User Agent may instead download resources in the following order: root document, 
    Styles.css, Visuals.js, Logo.png, Header.png, MainContent.mp4, Animations.css, Analytics.js, AdditionalImages1.png
    and AdditionalImages2.png. 
</p>

<h2 id="conformance-requirements"><span class="secno">2 </span>Conformance
requirements</h2>

<p>All diagrams, examples, and notes in this specification are non-normative,
as are all sections explicitly marked non-normative. Everything else in this
specification is normative. </p>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHOULD", "SHOULD NOT",
"RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this document
are to be interpreted as described in <a href="#rfc2119">RFC 2119</a>.
For readability, these words do not appear in all uppercase letters in this specification.</p>

<p>Requirements phrased in the imperative as part of algorithms (such as
"strip any leading space characters" or "return false and abort these steps")
are to be interpreted with the meaning of the key word ("must", "should",
"may", etc) used in introducing the algorithm. </p>

<p>Some conformance requirements are phrased as requirements on attributes,
methods or objects. Such requirements are to be interpreted as requirements
on user agents. </p>

<p>Conformance requirements phrased as algorithms or specific steps may be
implemented in any manner, so long as the end result is equivalent. (In
particular, the algorithms defined in this specification are intended to be
easy to follow, and not intended to be performant.) </p>

    <p>The IDL fragments in this specification must be interpreted as
    required for conforming IDL fragments, as described in the Web IDL
    specification. <a href="#WebIDL">[Web IDL]</a></p>

<h2 id="terminology"><span class="secno">3 </span>Terminology</h2>

<p>The construction "a <code title="">Foo</code> object", where <code
title="">Foo</code> is actually an interface, is sometimes used instead of
the more accurate "an object implementing the interface <code
title="">Foo</code>". </p>

<h2 id="sec-page-visibility"><span class="secno">4 <span class="auto-style1">Resource Priorities</span></span></h2>

<h3 id="sec-page-visibility-introduction"><span class="secno">4.1 </span>Introduction</h3>

<p>This section is non-normative.</p>

<p>
    This specification defines a means for site developers to programmatically give the User Agent
    hints on the download priority of a resource. This will allow User Agents to more efficiently
    manage the order in which resources are downloaded.
</p>

<h3 id="sec-document-interface"><span class="secno">4.2 </span><code>defer</code> attribute</h3>

<p>
   The <a href="#dom-defer"><code>defer</code></a> attribute can be specified on the following 
   <a href="http://www.w3.org/TR/html5/infrastructure.html#html-elements">HTML elements</a> and objects
   capable of <a href="http://www.w3.org/TR/html5/fetching-resources.html#fetch">fetching </a>resources:
</p>
<ul>
    <li><code><a href="http://www.w3.org/TR/html5/the-audio-element.html#audio">audio</a></code></li>
    <li><code><a href="http://www.w3.org/TR/html5/the-embed-element.html#the-embed-element">embed</a></code></li>
	<li><code><a href="http://www.w3.org/TR/html5/the-iframe-element.html#the-iframe-element">iframe</a></code></li>
	<li><code><a href="http://www.w3.org/TR/html5/the-img-element.html#the-img-element">img</a></code></li>
    <li><code><a href="http://www.w3.org/TR/html5/the-link-element.html#the-link-element">link</a></code></li>
    <li><code><a href="http://www.w3.org/TR/html5/the-object-element.html#the-object-element">object</a></code></li>
    <li><code><a href="http://www.w3.org/TR/html5/the-script-element.html#script">script</a></code></li>
    <li><code><a href="http://www.w3.org/TR/SVG11/struct.html#SVGElement">svg</a></code></li>
	<li><code><a href="http://www.w3.org/TR/html5/the-video-element.html#video">video</a></code></li>
    <li><code><a href="http://www.w3.org/TR/XMLHttpRequest/#interface-xmlhttprequest">XMLHttpRequest</a></code></li>
</ul>

<p>
    If the <a href="#dom-defer"><code>defer</code></a> attribute has been specified on a supported
    <a href="http://www.w3.org/TR/html5/infrastructure.html#html-elements">element</a> or object, the User Agent
    MAY defer downloading that resource until after all other <a href="http://www.w3.org/TR/html5/infrastructure.html#html-elements">elements</a>
    or objects without the <a href="#dom-defer"><code>defer</code></a> attribute that will be 
    <a href="http://www.w3.org/TR/html5/fetching-resources.html#fetch">fetching</a> a resource
    have started downloading.
</p>
<p>
    If the <a href="#dom-defer"><code>defer</code></a> attribute has been specified on a <code><a href="http://www.w3.org/TR/html5/the-script-element.html#script">script</a></code>
	element, the User Agent MAY, in addition to not downloading the resource until after all other 
	<a href="http://www.w3.org/TR/html5/infrastructure.html#html-elements">elements</a> or objects
    without the <a href="#dom-defer"><code>defer</code></a> attribute that will be 
    <a href="http://www.w3.org/TR/html5/fetching-resources.html#fetch">fetching</a> a resource
    have started downloading,
    not execute the script until after the document has been parsed.
</p>

<div class="ednote"><div class="ednoteHeader">Editorial note</div>
  <p>
	Open Issue: The <code>defer</code> attribute has already been used for <code>script</code> elements to mean that the script shouldn't
	be executed until the document has been parsed. As the developer's intention was to delay script execution, we may decide to build on that
	and also delay downloading the script until higher priority downloads have completed. Alternatively, we can keep the two separate by defining
	a <code>delay</code> attribute name instead of changing the meaning of the <code>defer</code> attribute.
  </p>
</div>


<p>
	Setting the <a href="#dom-defer"><code>defer</code></a> attribute on an 
    <a href="http://www.w3.org/TR/html5/infrastructure.html#html-elements">element</a> or object
	MUST NOT change when the <code>load</code> event is fired.
</p>

<div class="ednote"><div class="ednoteHeader">Editorial note</div>
  <p>
	Open Issue: There is a performance benefit of allowing deferred resources to not impact the <code>load</code> event timing, as scripts can execute
	sooner. 
  </p>
</div>

<h2 id="references"><span class="secno">6 </span>References</h2>

<dl>

   <dt id="rfc2119">[IETF RFC 2119]</dt>
   <dd>
    <cite><a href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a></cite>,
    Scott Bradner, Author. Internet Engineering Task Force, March 1997. Available at
    <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a>.
   </dd>

   <dt id="HTML5">[HTML5]</dt>
   <dd><cite><a href='http://www.w3.org/TR/html5/'>HTML5</a></cite>, Robin Berjon, et al, Editors. World Wide Web Consortium, December 2012. This version of the HTML5 is available from <a href='http://www.w3.org/TR/html5/'>http://www.w3.org/TR/html5/</a>. The <a href='http://dev.w3.org/html5/spec/'>latest editor's draft</a> is available at http://dev.w3.org/html5/spec/.</dd>

   <dt>[<a id="WebIDL">Web IDL</a>]</dt>
   <dd><cite><a href='http://www.w3.org/TR/2012/CR-WebIDL-20120419/'>Web IDL</a></cite>, Cameron McCormack, Editor. World Wide Web Consortium, April 2012. This version of the Web IDL specification is available from http://www.w3.org/TR/2012/CR-WebIDL-20120419/. The <a href='http://www.w3.org/TR/WebIDL/'>latest version of Web IDL</a> is available at http://www.w3.org/TR/WebIDL/.</dd>

</dl>


</body>
</html>
